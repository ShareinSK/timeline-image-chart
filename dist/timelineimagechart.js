"use strict";angular.module("timelineImageChartApp",[]).directive("timelineImageChart",function(){return{template:'<svg class="chart"></svg>',restrict:"EA",link:function(t,e,a){var i=t[a.chartData],n=i.options,r=e.find("svg")[0],o=[d3.time.hour,d3.time.day],l=void 0===n.width?1e3:n.width,s=void 0===n.height?400:n.height,c=void 0===n.offset?5:n.offset,d=void 0===n.tickType?d3.time.hour:o[n.tickType],u=void 0===n.tickDuration?12:n.tickDuration,p=void 0===n.xZoom?1:n.xZoom,y=void 0===n.yZoom?0:n.yZoom,m=void 0===n.color?"#000":n.color,f=d3.select(r).attr("width",l).attr("height",s).style("margin","20px"),v=d3.select("body").append("div").attr("class","tooltip").style("opacity",1),g=d3.time.scale().domain([d3.time.day.offset(new Date,0),d3.time.day.offset(new Date,c)]).range([0,l]),h=d3.scale.linear().domain([30,0]).range([0,s-75]),x=d3.behavior.zoom().x(g).y(h).scaleExtent([1,1]).on("zoom",function(){1===p&&(A.select(".x-axis").call(k),A.selectAll("image").attr("x",function(t){return g(t.date)}),A.selectAll("circle").attr("transform","translate("+d3.event.translate[0]+")scale("+d3.event.scale+")")),1===y&&(A.select(".y-axis").call(b),A.selectAll("image").attr("y",function(t){return h(t.y)}),A.selectAll("circle").attr("transform","translate(0, "+Math.min(s-75,d3.event.translate[1])+")scale("+d3.event.scale+")"))}),k=d3.svg.axis().scale(g).orient("bottom").ticks(d,u).innerTickSize(-(s-75)).outerTickSize(2),b=d3.svg.axis().scale(h).orient("left").outerTickSize(2).ticks(0).tickFormat(function(t){return""}).tickPadding(10),A=f.append("g").attr("transform","translate(5,10)");A.append("rect").attr("width",l).attr("height",s-75).style("fill","none").style("pointer-events","all").call(x),A.append("g").attr("class","x-axis").attr("transform","translate(0,"+(s-75)+")").call(k).selectAll("text").style("text-anchor","center"),A.append("g").attr("class","y-axis").call(b),"image"===n.type&&A.selectAll(null).data(i.data).enter().append("image").attr("width","25px").attr("height","25px").attr({x:function(t){return g(t.date)},y:function(t){return h(t.y)}}).attr("xlink:href",function(t){return void 0!==t.url?t.url:"https://github.com/favicon.ico"}).style("cursor","pointer").on("mouseover",function(t){v.transition().duration(200).style("opacity",.9),v.html(t.date.toDateString()+"<br>"+(void 0!=t.label?t.label:" ")).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){v.transition().duration(500).style("opacity",0)}),"circle"===n.type&&A.selectAll(null).data(i.data).enter().append("circle").attr("r",function(t){return 5}).attr("cy",function(t){return h(t.y)}).attr("cx",function(t){return g(t.date)}).attr("fill",m).attr("opacity",1).style("stroke",m).style("cursor","pointer").on("mouseover",function(t){v.transition().duration(200).style("opacity",.9),v.html(t.date.toDateString()+"<br>"+(void 0!=t.label?t.label:" ")).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(t){v.transition().duration(500).style("opacity",0)})}}});